<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>λα.mbdα</title><link href="https://fakedrake.github.io/" rel="alternate"></link><link href="https://fakedrake.github.io/feeds/chris-perivolaropoulos.atom.xml" rel="self"></link><id>https://fakedrake.github.io/</id><updated>2016-09-29T03:54:00+03:00</updated><entry><title>Transfer files to your phone over wifi</title><link href="https://fakedrake.github.io/transfer-files-to-your-phone-over-wifi.html" rel="alternate"></link><updated>2016-09-29T03:54:00+03:00</updated><author><name>Chris Perivolaropoulos</name></author><id>tag:fakedrake.github.io,2016-09-29:transfer-files-to-your-phone-over-wifi.html</id><summary type="html">&lt;p&gt;So here is a neat trick to very quickly transfer files to your phone
over wifi (http). On your computer download &lt;code&gt;qrencode&lt;/code&gt;. It should be
in all major package managers. Also make sure you have python
installed. On your phone install a QR code reader.&lt;/p&gt;
&lt;p&gt;Open a terminal and navigate to the folder where your file is. Then
run this on &lt;em&gt;OSX&lt;/em&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;ifconfig en0 | awk &amp;#39;BEGIN{FS=&amp;quot; &amp;quot;} /^\t*inet /{print &amp;quot;http://&amp;quot;$2&amp;quot;:8000&amp;quot;}&amp;#39; | xargs qrencode -o /tmp/url_local_qr.png &amp;amp;&amp;amp; open /tmp/url_local_qr.png
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;or this on &lt;em&gt;linux&lt;/em&gt; (didn't try it so comment if there was a problem):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;ifconfig wlan0 | awk &amp;#39;BEGIN{FS=&amp;quot; &amp;quot;} /^\t*inet /{print &amp;quot;http://&amp;quot;$2&amp;quot;:8000&amp;quot;}&amp;#39; | xargs qrencode -o /tmp/url_local_qr.png &amp;amp;&amp;amp; dispaly /tmp/url_local_qr.png
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;You should be presented with a QR code. Scan it with your phone and
you should have access to your computer's files!&lt;/p&gt;</summary><category term="unix"></category></entry><entry><title>Category theory terminology</title><link href="https://fakedrake.github.io/category-theory-terminology.html" rel="alternate"></link><updated>2016-09-03T13:13:00+03:00</updated><author><name>Chris Perivolaropoulos</name></author><id>tag:fakedrake.github.io,2016-09-03:category-theory-terminology.html</id><summary type="html">&lt;p&gt;I am not very good with terminology. I have found myself looking up
the same terminology again and again so here is a list of terms that
are quite common.&lt;/p&gt;
&lt;h1&gt;Morphisms&lt;/h1&gt;
&lt;h2&gt;Epimorphism&lt;/h2&gt;
&lt;h2&gt;Monomorphism&lt;/h2&gt;
&lt;h2&gt;Homomorphism&lt;/h2&gt;
&lt;h3&gt;Isomorphism&lt;/h3&gt;
&lt;h3&gt;Endomorphism&lt;/h3&gt;
&lt;h3&gt;Automorphism&lt;/h3&gt;
&lt;h2&gt;Hom-Set / Hom(A,B)&lt;/h2&gt;
&lt;p&gt;Set of all homomorphisms &lt;code&gt;A -&amp;gt; B&lt;/code&gt;&lt;/p&gt;
&lt;h1&gt;Functors&lt;/h1&gt;
&lt;p&gt;Mapping of all objects &lt;em&gt;and&lt;/em&gt; all morphisms of a category to another
cateogry (the functor).&lt;/p&gt;
&lt;h2&gt;Hom(-,A)&lt;/h2&gt;
&lt;p&gt;A functor that has objects &lt;code&gt;foral x . Hom(x,A)&lt;/code&gt; and morphisms &lt;code&gt;forall
x,y . Hom(x,A) -&amp;gt; Hom(y,A)&lt;/code&gt;&lt;/p&gt;
&lt;h2&gt;Covariant/Contravariant functor&lt;/h2&gt;
&lt;p&gt;A functor that preserves/reverses the direction of a category.&lt;/p&gt;
&lt;h2&gt;Bifunctor&lt;/h2&gt;
&lt;p&gt;A functor whose domain is a product category.&lt;/p&gt;
&lt;h1&gt;Misc&lt;/h1&gt;
&lt;p&gt;Some other stuff&lt;/p&gt;
&lt;h2&gt;Terminal object&lt;/h2&gt;
&lt;p&gt;An object in a category to which we have only inbound arrows.&lt;/p&gt;
&lt;h2&gt;Initial object&lt;/h2&gt;
&lt;p&gt;An object in a categor from which there exist only outbound arrows&lt;/p&gt;
&lt;h2&gt;Small category&lt;/h2&gt;
&lt;p&gt;A category with a set (not proper class) of objects and a set of
homomorphisms. Locally small if only the morphisms are a set.&lt;/p&gt;
&lt;h2&gt;Class&lt;/h2&gt;
&lt;p&gt;I couldn't find any concrete definition for a class. Basically it's
all the sets plus all paradoxical sets (proper classes).&lt;/p&gt;
&lt;h2&gt;Burali-Forti Paradox&lt;/h2&gt;
&lt;p&gt;A variant of the Russell Paradox whereby since Von Neuman numbers are
a representation of ordinals the notion of a set of ordinals is
paradoxical.&lt;/p&gt;
&lt;h2&gt;Thin Category&lt;/h2&gt;
&lt;p&gt;A category where &lt;code&gt;| Hom(A,B) | &amp;lt;= 1&lt;/code&gt;.&lt;/p&gt;</summary><category term="category-theory"></category></entry><entry><title>Intstalling NVM and node-js on unix</title><link href="https://fakedrake.github.io/intstalling-nvm-and-nodejs.html" rel="alternate"></link><updated>2016-08-12T11:51:00+03:00</updated><author><name>Chris Perivolaropoulos</name></author><id>tag:fakedrake.github.io,2016-08-12:intstalling-nvm-and-nodejs.html</id><summary type="html">&lt;p&gt;Just run the following that will setup everything for you:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="x"&gt;wget -qO- https://raw.githubusercontent.com/creationix/nvm/v0.31.4/install.sh | bash&lt;/span&gt;
&lt;span class="x"&gt;export NVM_DIR=&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;HOME&lt;/span&gt;&lt;span class="x"&gt;/.nvm&amp;quot;&lt;/span&gt;
&lt;span class="x"&gt;[ -s &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;NVM_DIR&lt;/span&gt;&lt;span class="x"&gt;/nvm.sh&amp;quot; ] &amp;amp;&amp;amp; . &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;NVM_DIR&lt;/span&gt;&lt;span class="x"&gt;/nvm.sh&amp;quot; &lt;/span&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="x"&gt; This loads nvm&lt;/span&gt;
&lt;span class="x"&gt;nvm install node&lt;/span&gt;
&lt;span class="x"&gt;nvm use node&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;This will run everything for you. Check the version:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;node --version
v6.3.1
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Your version may differ. This is a concise version of the
&lt;a href="https://github.com/creationix/nvm#install-script"&gt;official instructions&lt;/a&gt;&lt;/p&gt;</summary><category term="nodejs"></category></entry><entry><title>Installing haskell on linux</title><link href="https://fakedrake.github.io/installing-haskell-on-linux.html" rel="alternate"></link><updated>2016-06-14T11:30:00+03:00</updated><author><name>Chris Perivolaropoulos</name></author><id>tag:fakedrake.github.io,2016-06-14:installing-haskell-on-linux.html</id><summary type="html">&lt;p&gt;If for some reason you don't want to use your distribution's package
manager (eg because it provides an outdated version of GHC), you can
install it manually. First you need to find out if you are on x64 or
32bit architecture. You can do that by running:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;uname -a
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;If you are on 32bit run the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;wget https://haskell.org/platform/download/8.0.1/haskell-platform-8.0.1-unknown-posix--minimal-i386.tar.gz -O /tmp/haskell.tar.gz
cd /tmp
tar xvzf /tmp/haskell.tar.gz
sudo ./install-haskell-platform.sh
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;If you are on x64:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;wget https://haskell.org/platform/download/8.0.1/haskell-platform-8.0.1-unknown-posix--full-x86_64.tar.gz -O /tmp/haskell.tar.gz
cd /tmp
tar xvzf /tmp/haskell.tar.gz
sudo ./install-haskell-platform.sh
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Then restart your shell. Check that you have the correct version
(8.0.1) by running:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;ghc --version
The Glorious Glasgow Haskell Compilation System, version 8.0.1
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;If you do not, you probably already had a version of the haskell
platform installed. Uninstall that and you will be good to go.&lt;/p&gt;
&lt;p&gt;The above is just a copy-paste-able format of
the instructions in
&lt;a href="https://www.haskell.org/platform/linux.html#linux-generic"&gt;haskell.org&lt;/a&gt;&lt;/p&gt;</summary><category term="haskell"></category><category term="linux"></category></entry><entry><title>Teaching emacs to copy utf-8 on Mac OS X</title><link href="https://fakedrake.github.io/teaching-emacs-to-copy-utf-8-on-mac-os-x.html" rel="alternate"></link><updated>2016-05-12T16:48:00+03:00</updated><author><name>Chris Perivolaropoulos</name></author><id>tag:fakedrake.github.io,2016-05-12:teaching-emacs-to-copy-utf-8-on-mac-os-x.html</id><summary type="html">&lt;p&gt;Mac OS X comes with a command line tool for maniplating the clipboard
called &lt;code&gt;pbcopy&lt;/code&gt;. It's usage is simple: you throw stuff in it's stdin
and that stuff is copied to the clipboard. This way we can teach emacs
to copy stuff to the clipboard with this function&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defun&lt;/span&gt; &lt;span class="nv"&gt;paste-to-osx&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;text&lt;/span&gt; &lt;span class="k"&gt;&amp;amp;optional&lt;/span&gt; &lt;span class="nb"&gt;push&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;let&lt;/span&gt; &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="nv"&gt;process-connection-type&lt;/span&gt; &lt;span class="no"&gt;nil&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;default-directory&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;~&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;let&lt;/span&gt; &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="nv"&gt;proc&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;start-process&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;pbcopy&amp;quot;&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;*Messages*&amp;quot;&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;pbcopy&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
      &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;process-send-string&lt;/span&gt; &lt;span class="nv"&gt;proc&lt;/span&gt; &lt;span class="nv"&gt;text&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;process-send-eof&lt;/span&gt; &lt;span class="nv"&gt;proc&lt;/span&gt;&lt;span class="p"&gt;))))&lt;/span&gt;


&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;setq&lt;/span&gt; &lt;span class="nv"&gt;interprogram-cut-function&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;paste-to-osx&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;And this will work pretty well for englshIf you. It will however fail
in other languages. For example copying the string &lt;code&gt;λογος, αιμα,
νοημα&lt;/code&gt; from an emacs buffer will paste as random unicode characeters.&lt;/p&gt;
&lt;p&gt;Setting the &lt;code&gt;LANG&lt;/code&gt; env var fixes the problem.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;(defun paste-to-osx (text &amp;amp;optional push)
  (let ((process-connection-type nil)
        (lang (getenv &amp;quot;LANG&amp;quot;))
        (default-directory &amp;quot;~&amp;quot;))
    (setenv &amp;quot;LANG&amp;quot; &amp;quot;en_US.UTF-8&amp;quot;)
    (let ((proc (start-process &amp;quot;pbcopy&amp;quot; &amp;quot;*Messages*&amp;quot; &amp;quot;pbcopy&amp;quot;)))
      (process-send-string proc text)
      (process-send-eof proc))
    (setenv &amp;quot;LANG&amp;quot; lang)))
&lt;/pre&gt;&lt;/div&gt;</summary><category term="emacs"></category><category term="macosx"></category></entry><entry><title>Streaming Data through HTTP with Haskell</title><link href="https://fakedrake.github.io/streaming-data-through-http-with-haskell.html" rel="alternate"></link><updated>2016-04-30T03:33:00+03:00</updated><author><name>Chris Perivolaropoulos</name></author><id>tag:fakedrake.github.io,2016-04-30:streaming-data-through-http-with-haskell.html</id><summary type="html">&lt;p&gt;So I wanted to do some processing on wikipedia articles but I don't
have enough disk space to download them first and process them later,
it needs to be on-the-fly. Fortunately they are stored bziped which
means they are compressed at the block level and I don't need the last
byte to know what the first one means. So I begun by finding a way to
stream data. I struggled with Conduit a bit but then I stumbled upon a
much simpler solution:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kr"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;Network.HTTP.Client&lt;/span&gt;
&lt;span class="kr"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;Network.HTTP.Client.TLS&lt;/span&gt;   &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;tlsManagerSettings&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="kr"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;Control.Monad.Fix&lt;/span&gt;
&lt;span class="kr"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;Data.Conduit&lt;/span&gt;
&lt;span class="kr"&gt;import&lt;/span&gt; &lt;span class="k"&gt;qualified&lt;/span&gt; &lt;span class="nn"&gt;Data.ByteString&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;BS&lt;/span&gt;

&lt;span class="nf"&gt;url&lt;/span&gt; &lt;span class="ow"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;https://dumps.wikimedia.org/enwiki/latest/enwiki-latest-pages-articles.xml.bz2&amp;quot;&lt;/span&gt;

&lt;span class="nf"&gt;printLen&lt;/span&gt; &lt;span class="n"&gt;bytes&lt;/span&gt; &lt;span class="ow"&gt;=&lt;/span&gt; &lt;span class="n"&gt;putStrLn&lt;/span&gt; &lt;span class="o"&gt;$&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Got bytes: &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;++&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;show&lt;/span&gt; &lt;span class="o"&gt;$&lt;/span&gt; &lt;span class="kt"&gt;BS&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;length&lt;/span&gt; &lt;span class="n"&gt;bytes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="nf"&gt;getResp&lt;/span&gt; &lt;span class="ow"&gt;::&lt;/span&gt; &lt;span class="kt"&gt;String&lt;/span&gt; &lt;span class="ow"&gt;-&amp;gt;&lt;/span&gt;  &lt;span class="kt"&gt;IO&lt;/span&gt; &lt;span class="nb"&gt;()&lt;/span&gt;
&lt;span class="nf"&gt;getResp&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt; &lt;span class="ow"&gt;=&lt;/span&gt; &lt;span class="kr"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;man&lt;/span&gt; &lt;span class="ow"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="n"&gt;newManager&lt;/span&gt; &lt;span class="n"&gt;tlsManagerSettings&lt;/span&gt;
  &lt;span class="n"&gt;req&lt;/span&gt; &lt;span class="ow"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="n"&gt;parseUrl&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;
  &lt;span class="n"&gt;withResponse&lt;/span&gt; &lt;span class="n"&gt;req&lt;/span&gt; &lt;span class="n"&gt;man&lt;/span&gt; &lt;span class="o"&gt;$&lt;/span&gt; &lt;span class="nf"&gt;\&lt;/span&gt;&lt;span class="n"&gt;res&lt;/span&gt; &lt;span class="ow"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kr"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;putStrLn&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Got a response, now streaming...&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;fix&lt;/span&gt; &lt;span class="o"&gt;$&lt;/span&gt; &lt;span class="nf"&gt;\&lt;/span&gt;&lt;span class="n"&gt;loop&lt;/span&gt; &lt;span class="ow"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kr"&gt;do&lt;/span&gt;
      &lt;span class="n"&gt;bytes&lt;/span&gt; &lt;span class="ow"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="n"&gt;brRead&lt;/span&gt; &lt;span class="o"&gt;$&lt;/span&gt; &lt;span class="n"&gt;responseBody&lt;/span&gt; &lt;span class="n"&gt;res&lt;/span&gt;
      &lt;span class="kr"&gt;if&lt;/span&gt; &lt;span class="kt"&gt;BS&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;null&lt;/span&gt; &lt;span class="n"&gt;bytes&lt;/span&gt; &lt;span class="kr"&gt;then&lt;/span&gt; &lt;span class="n"&gt;putStrLn&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Done!&amp;quot;&lt;/span&gt; &lt;span class="kr"&gt;else&lt;/span&gt; &lt;span class="kr"&gt;do&lt;/span&gt;
        &lt;span class="n"&gt;putStrLn&lt;/span&gt; &lt;span class="o"&gt;$&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Got &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;++&lt;/span&gt; &lt;span class="n"&gt;show&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;BS&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;length&lt;/span&gt; &lt;span class="n"&gt;bytes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;++&lt;/span&gt; &lt;span class="s"&gt;&amp;quot; but will ignore&amp;quot;&lt;/span&gt;
        &lt;span class="n"&gt;loop&lt;/span&gt;

&lt;span class="nf"&gt;main&lt;/span&gt; &lt;span class="ow"&gt;=&lt;/span&gt; &lt;span class="kr"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;getResp&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;This just downloads the data, I haven't yet looked into actually
decompressing. My plan is to convert this fixpoint call into a conduit
and pipe the data trhough uncompression -- the conduit xml parser that
is quite neat -- whatever processing I want. Fingers crossed.&lt;/p&gt;</summary></entry><entry><title>Limiting simultaneous threads in Haskell</title><link href="https://fakedrake.github.io/limiting-parallel-thread-in-haskell.html" rel="alternate"></link><updated>2016-04-29T02:23:00+03:00</updated><author><name>Chris Perivolaropoulos</name></author><id>tag:fakedrake.github.io,2016-04-29:limiting-parallel-thread-in-haskell.html</id><summary type="html">&lt;p&gt;Iwas making a mini crawler to download all mp3s from a website in
Haskell and was confronted with the following problem: it is easy to
download stuff serially or to download them all in parallel. What is
slightly harder is to download just a couple in parallel.&lt;/p&gt;
&lt;p&gt;I will start with an introduction it &lt;code&gt;MVar&lt;/code&gt;. Let's say we want a
safer &lt;code&gt;putStrLn&lt;/code&gt; that does not interleave it's output with other
&lt;code&gt;putStrLn&lt;/code&gt;s but rather waits for it's turn:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kr"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;Control.Concurrent.MVar&lt;/span&gt;

&lt;span class="nf"&gt;putStrLn&amp;#39;&lt;/span&gt; &lt;span class="n"&gt;lock&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;=&lt;/span&gt; &lt;span class="kr"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;putMVar&lt;/span&gt; &lt;span class="n"&gt;lock&lt;/span&gt; &lt;span class="nb"&gt;()&lt;/span&gt;
  &lt;span class="n"&gt;putStrLn&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;
  &lt;span class="n"&gt;takeMVar&lt;/span&gt; &lt;span class="n"&gt;lock&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Then we call it like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;main &lt;span class="o"&gt;=&lt;/span&gt; do
  ioLock &lt;span class="o"&gt;&amp;lt;-&lt;/span&gt; newEmptyMVar
  &lt;span class="kc"&gt;...&lt;/span&gt;
  putStrLn&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="err"&gt; ioLock $ &amp;quot;Found talks: &amp;quot; ++ (show $ length urls)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now that was fairly easy. What about the case where we want a few
simultaneous threads and the rest should wait for any of them to
finish.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c1"&gt;-- | There is no 0 state for MVar. 0 means taken. So check if it is&lt;/span&gt;
&lt;span class="c1"&gt;-- taken and if so treat it as 0 by putting 1, otherwise take,&lt;/span&gt;
&lt;span class="c1"&gt;-- increment, put&lt;/span&gt;
&lt;span class="nf"&gt;increment&lt;/span&gt; &lt;span class="ow"&gt;::&lt;/span&gt; &lt;span class="kt"&gt;MVar&lt;/span&gt; &lt;span class="kt"&gt;Int&lt;/span&gt; &lt;span class="ow"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;IO&lt;/span&gt; &lt;span class="kt"&gt;Int&lt;/span&gt;
&lt;span class="nf"&gt;increment&lt;/span&gt; &lt;span class="n"&gt;procs&lt;/span&gt; &lt;span class="ow"&gt;=&lt;/span&gt; &lt;span class="kr"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;taken&lt;/span&gt; &lt;span class="ow"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="n"&gt;isEmptyMVar&lt;/span&gt; &lt;span class="n"&gt;procs&lt;/span&gt;
  &lt;span class="kr"&gt;if&lt;/span&gt; &lt;span class="n"&gt;taken&lt;/span&gt; &lt;span class="kr"&gt;then&lt;/span&gt; &lt;span class="n"&gt;putMVar&lt;/span&gt; &lt;span class="n"&gt;procs&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="kr"&gt;else&lt;/span&gt; &lt;span class="kr"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;num&lt;/span&gt; &lt;span class="ow"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="n"&gt;takeMVar&lt;/span&gt; &lt;span class="n"&gt;procs&lt;/span&gt;
    &lt;span class="n"&gt;putMVar&lt;/span&gt; &lt;span class="n"&gt;procs&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;num&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;return&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;num&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;-- | If we are going for 0 don&amp;#39;t put back. 0 is special in that it&lt;/span&gt;
&lt;span class="c1"&gt;-- blocks everyone trying to decrement.&lt;/span&gt;
&lt;span class="nf"&gt;decrement&lt;/span&gt; &lt;span class="ow"&gt;::&lt;/span&gt; &lt;span class="kt"&gt;MVar&lt;/span&gt; &lt;span class="kt"&gt;Int&lt;/span&gt; &lt;span class="ow"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;IO&lt;/span&gt; &lt;span class="kt"&gt;Int&lt;/span&gt;
&lt;span class="nf"&gt;decrement&lt;/span&gt; &lt;span class="n"&gt;procsLock&lt;/span&gt; &lt;span class="ow"&gt;=&lt;/span&gt; &lt;span class="kr"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;num&lt;/span&gt; &lt;span class="ow"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="n"&gt;takeMVar&lt;/span&gt; &lt;span class="n"&gt;procsLock&lt;/span&gt;
  &lt;span class="kr"&gt;if&lt;/span&gt; &lt;span class="n"&gt;num&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="kr"&gt;then&lt;/span&gt; &lt;span class="n"&gt;putMVar&lt;/span&gt; &lt;span class="n"&gt;procsLock&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;num&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;return&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;num&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="kr"&gt;else&lt;/span&gt; &lt;span class="n"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;

&lt;span class="c1"&gt;-- | Decrement until we are done then increment&lt;/span&gt;
&lt;span class="nf"&gt;guarded&lt;/span&gt; &lt;span class="ow"&gt;::&lt;/span&gt; &lt;span class="kt"&gt;MVar&lt;/span&gt; &lt;span class="nb"&gt;()&lt;/span&gt; &lt;span class="ow"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;MVar&lt;/span&gt; &lt;span class="kt"&gt;Int&lt;/span&gt; &lt;span class="ow"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;IO&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="ow"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;IO&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;
&lt;span class="nf"&gt;guarded&lt;/span&gt; &lt;span class="n"&gt;ioLock&lt;/span&gt; &lt;span class="n"&gt;procsLock&lt;/span&gt; &lt;span class="n"&gt;io&lt;/span&gt; &lt;span class="ow"&gt;=&lt;/span&gt; &lt;span class="kr"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;slotsLeft&lt;/span&gt; &lt;span class="ow"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="n"&gt;decrement&lt;/span&gt; &lt;span class="n"&gt;procsLock&lt;/span&gt;
  &lt;span class="n"&gt;putStrLn&amp;#39;&lt;/span&gt; &lt;span class="n"&gt;ioLock&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Slots left: &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;++&lt;/span&gt; &lt;span class="n"&gt;show&lt;/span&gt; &lt;span class="n"&gt;slotsLeft&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="n"&gt;ret&lt;/span&gt; &lt;span class="ow"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="n"&gt;io&lt;/span&gt;
  &lt;span class="n"&gt;increment&lt;/span&gt; &lt;span class="n"&gt;procsLock&lt;/span&gt;
  &lt;span class="n"&gt;return&lt;/span&gt; &lt;span class="n"&gt;ret&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;You can call it like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kr"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;Control.Monad.Parallel&lt;/span&gt;

&lt;span class="nf"&gt;main&lt;/span&gt; &lt;span class="ow"&gt;=&lt;/span&gt; &lt;span class="kr"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;procs&lt;/span&gt; &lt;span class="ow"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="n"&gt;newMVar&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;
  &lt;span class="o"&gt;...&lt;/span&gt;
  &lt;span class="n"&gt;data_&lt;/span&gt; &lt;span class="ow"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="n"&gt;mapM_&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;guarded&lt;/span&gt; &lt;span class="n"&gt;ioLock&lt;/span&gt; &lt;span class="n"&gt;procs&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="n"&gt;getUrl&lt;/span&gt; &lt;span class="n"&gt;ioLock&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;urls&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;And &lt;code&gt;getUrl&lt;/code&gt; will run at most 5 times simultaneously.&lt;/p&gt;</summary></entry><entry><title>Automated insights with org mode</title><link href="https://fakedrake.github.io/automated-insights-with-org-mode.html" rel="alternate"></link><updated>2016-01-29T15:22:00+02:00</updated><author><name>Chris Perivolaropoulos</name></author><id>tag:fakedrake.github.io,2016-01-29:automated-insights-with-org-mode.html</id><summary type="html">&lt;p&gt;title:
date: 2016-01-29 15:22
tags: org-mode,emacs
category:
slug: automated-insights-with-org-mode
author: Chris PerivolaropoulosYY&lt;/p&gt;
&lt;p&gt;title: Automated insights with org mode
date: 2016-05-12 16:10
title: Automated insights with org mode
date: 2016-01-29 15:22
tags: org-mode,emacs
category:
slug: automated-insights-with-org-mode
author: Chris Perivolaropoulos&lt;/p&gt;
&lt;p&gt;The other day I trying to evaluate various roadmaps that a projact
could continue into and try to compare the cost and the duration of
each solution. I started off writing a an org mode document describing
each scenario separately and putting each task in it's separate
heading. Soon I made the following observation:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Some tasks had unknown duration&lt;/li&gt;
&lt;li&gt;Many tasks were common for more than one solution&lt;/li&gt;
&lt;/ul&gt;</summary><category term="org-mode"></category><category term="emacs"></category></entry><entry><title>Killing mysql queries</title><link href="https://fakedrake.github.io/killing-mysql-queries.html" rel="alternate"></link><updated>2016-01-20T13:07:00+02:00</updated><author><name>Chris Perivolaropoulos</name></author><id>tag:fakedrake.github.io,2016-01-20:killing-mysql-queries.html</id><summary type="html">&lt;p&gt;MySQL queries are many times painfully slow. So slow that it is not
worth waiting. Here is how to kill a running query.&lt;/p&gt;
&lt;p&gt;First of all you need to know what is running to choose what to kill.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&amp;gt; show processlist
|       Id | User | Host | db      | Command | Time | State        | Info                      |
|----------+------+------+---------+---------+------+--------------+---------------------------|
| 35162105 | me   | host | db_name | Query   |  183 | Sending data | SELECT * FROM `HugeTable` |
| 35162616 | me   | host | db_name | Query   |    0 | NULL         | show processlist          |
| 35162617 | me   | host | db_name | Sleep   |    0 |              | NULL                      |
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The last process we don't care about and the one before that is the
one we just ran to get the process list itself. The first one is the
one to kill. So now that we have the id, we can kill it by running&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&amp;gt; kill 35162105
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;And we freed up the server!&lt;/p&gt;</summary></entry><entry><title>Enabling python virtualenvs dumb and fast</title><link href="https://fakedrake.github.io/enabling-python-virtualenvs-dumb-and-fast.html" rel="alternate"></link><updated>2014-07-16T19:27:00+03:00</updated><author><name>Chris Perivolaropoulos</name></author><id>tag:fakedrake.github.io,2014-07-16:enabling-python-virtualenvs-dumb-and-fast.html</id><summary type="html">&lt;p&gt;Unless you are using
&lt;a href="https://bitbucket.org/dhellmann/virtualenvwrapper/"&gt;virtualenvwrapper&lt;/a&gt;
or something else fancy that the cool kids like these days a common
series of commands to run python tests is. I also annotated my
thinking process for dramatic purposes.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt; Let&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;s work on awesome-project a bit
&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;cd &lt;/span&gt;python/project/path/awesome-project
&lt;span class="gp"&gt;#&lt;/span&gt; That went well, good job, you deserve eternal love and
&lt;span class="gp"&gt;#&lt;/span&gt; admiration, running some tes- crap, I need the virtualenv...
&lt;span class="gp"&gt;$&lt;/span&gt; ls ..
&lt;span class="gp"&gt;#&lt;/span&gt; Pff ok which one of those looks like a virtualenv...
&lt;span class="gp"&gt;$&lt;/span&gt; . ../py/bin/activate
&lt;span class="gp"&gt;#&lt;/span&gt; Bingo! Where was I?
&lt;span class="gp"&gt;$&lt;/span&gt; python setup.py &lt;span class="nb"&gt;test&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now besides being lazy I am also inconsistent, dumb and have a very
hard time context switching like that. Thankfully shell scripting can
help out with this. I recently added this stupid little function in my
&lt;em&gt;.zshrc&lt;/em&gt; and my life has been a wonderful journey in unicorn rainbow
land ever since&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;# find the first venv backwards and activate it.&lt;/span&gt;
pv&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="nv"&gt;A&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;./*/bin/activate&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; i in &lt;span class="o"&gt;{&lt;/span&gt;1..&lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;pwd&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; grep -o / &lt;span class="p"&gt;|&lt;/span&gt; wc -l&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; bash -c &lt;span class="s2"&gt;&amp;quot;ls &lt;/span&gt;&lt;span class="nv"&gt;$A&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; 2&amp;gt; /dev/null&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
        &lt;span class="nb"&gt;source&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;bash -c &lt;span class="s2"&gt;&amp;quot;ls &lt;/span&gt;&lt;span class="nv"&gt;$A&lt;/span&gt;&lt;span class="s2"&gt; | head -1&amp;quot;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="nb"&gt;break&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="k"&gt;fi&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nv"&gt;A&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;../&lt;span class="nv"&gt;$A&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="k"&gt;done&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now it's all like&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;#&lt;/span&gt; Work on awesome-project
&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;cd &lt;/span&gt;python/project/path/awesome-project
&lt;span class="gp"&gt;#&lt;/span&gt; Women and glory are just around the corner, Oh, virtualenv
&lt;span class="gp"&gt;$&lt;/span&gt; pv
&lt;span class="gp"&gt;#&lt;/span&gt; Set!
&lt;span class="gp"&gt;$&lt;/span&gt; python setup.py &lt;span class="nb"&gt;test&lt;/span&gt;
&lt;span class="go"&gt;[...]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><category term="python"></category><category term="virtualenv"></category><category term="shell"></category></entry><entry><title>Ethernet deadlocks and forking the kernel</title><link href="https://fakedrake.github.io/ethernet-deadlocks-and-forking-the-kernel.html" rel="alternate"></link><updated>2014-07-16T18:25:00+03:00</updated><author><name>Chris Perivolaropoulos</name></author><id>tag:fakedrake.github.io,2014-07-16:ethernet-deadlocks-and-forking-the-kernel.html</id><summary type="html">&lt;p&gt;This is a bit specific but it is something I encountered more than
once and spent a couple of hours trying to fix. So here is the
problem. I have a xilinx zynq zc702 board and I load a slightly
customized 3.8 linux kernel on it. I boot it and it freezes at&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;loop&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;module&lt;/span&gt; &lt;span class="n"&gt;loaded&lt;/span&gt;
&lt;span class="n"&gt;xqspips&lt;/span&gt; &lt;span class="n"&gt;e000d000&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;spi&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;master&lt;/span&gt; &lt;span class="k"&gt;is&lt;/span&gt; &lt;span class="n"&gt;unqueued&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt; &lt;span class="k"&gt;is&lt;/span&gt; &lt;span class="n"&gt;deprecated&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now now you probably want to know what boot arguments I was using and
what kind of modifications I have made to the kernel and the exact
release but it doesn't really matter. The problem was the xqspips
driver and not the fact that something is deprecated -who knows what
this message means exactly-.&lt;/p&gt;
&lt;p&gt;Let me walk you through around the problem what happens in
&lt;a href="https://github.com/fakedrake/linux-thinksilicon/blob/qemu/drivers/spi/spi-xilinx-qps.c"&gt;drivers/spi/spi-xilinx-qps.c&lt;/a&gt;
when a spi transfer commences.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;xqspips_start_transfer&lt;/code&gt; runs&lt;/li&gt;
&lt;li&gt;At some poiunt it writes to &lt;code&gt;XQSPIPS_IEN_OFFSET&lt;/code&gt; register to raise
  an interrupt that will call asynchronously &lt;code&gt;xqspips_irq&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;xqspips_start_transfer&lt;/code&gt; inits some other stuff and then waits for
  &lt;code&gt;xqspips_irq&lt;/code&gt; to set a completion structure.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Now &lt;code&gt;xqspips_irq&lt;/code&gt; is passed a &lt;code&gt;xqspips&lt;/code&gt; structure that contains
information about how much data we want to transmit and how much data
we expect to receive.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;First it checks with the status register to see if there is some
  space in the transfer buffer or that there is something useful in
  the receive buffer.&lt;/li&gt;
&lt;li&gt;While the receive buffer is not empty try to read data from it
  decrementing &lt;code&gt;struct xqspips-&amp;gt;bytes_to_receive&lt;/code&gt; correctly.&lt;/li&gt;
&lt;li&gt;If there is stuff to transfer, transfer it&lt;/li&gt;
&lt;li&gt;If &lt;code&gt;struct xqspips-&amp;gt;bytes_to_receive&lt;/code&gt; is not yet zero reissue an
  interrupt in a slightly different way than before and finalize.&lt;/li&gt;
&lt;li&gt;If &lt;code&gt;struct xqspips-&amp;gt;bytes_to_receive&lt;/code&gt; is zero complete the
  completion struct that &lt;code&gt;xqspips_start_transfer&lt;/code&gt; is waiting for and
  finalize.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The above is a rough descriuption of the situation. Now I don't know
if it is a hardware problem or a driver bug but there are two problems
here. One is that &lt;code&gt;xqspi-&amp;gt;bytes_to_receive&lt;/code&gt; is 1 while the status
register claims there is no data in the buffer. And also setting the
&lt;code&gt;IEN&lt;/code&gt; register doesn't raise an interrupt. Thus irq callback fails to
read the data isntructed by &lt;code&gt;xqspi-&amp;gt;bytes_to_receive&lt;/code&gt; and proceeds
finish confident that an interrupt was raised to take care of the
situation.&lt;/p&gt;
&lt;p&gt;The hard part of this was finding all the above out. Then it was
trivial to just tell &lt;code&gt;xqspips_irq&lt;/code&gt; to not only check the status
register to decide whether it should read or not, but also check with
the xqspi struct. Essentially changing&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="cm"&gt;/* Read out the data from the RX FIFO */&lt;/span&gt;
&lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;xqspips_read&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;xqspi&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;regs&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;XQSPIPS_STATUS_OFFSET&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;
    &lt;span class="n"&gt;XQSPIPS_IXR_RXNEMTY_MASK&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;into&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="cm"&gt;/* Read out the data from the RX FIFO */&lt;/span&gt;
&lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;xqspips_read&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;xqspi&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;regs&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;XQSPIPS_STATUS_OFFSET&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;
    &lt;span class="n"&gt;XQSPIPS_IXR_RXNEMTY_MASK&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt;
    &lt;span class="n"&gt;xqspi&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;bytes_to_receive&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;did the trick.&lt;/p&gt;</summary><category term="drivers"></category><category term="irq"></category><category term="linux"></category><category term="kernel"></category></entry><entry><title>Programmatically add search engines to firefox</title><link href="https://fakedrake.github.io/programmatically-add-search-engines-to-firefox.html" rel="alternate"></link><updated>2014-06-07T15:21:00+03:00</updated><author><name>Chris Perivolaropoulos</name></author><id>tag:fakedrake.github.io,2014-06-07:programmatically-add-search-engines-to-firefox.html</id><summary type="html">&lt;p&gt;What we are doing here is adding a search engine to firefox like real
men ie programmatically. This is nice because you can then write
scripts to do interesting stuff with them. First of all let's see what
we can find out without looking at code.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="go"&gt;(py)fakedrake@monolith ~/.mozilla/firefox/gsz5q06m.default $ find -name &amp;quot;*search*&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt;./search-metadata.json&lt;/span&gt;
&lt;span class="go"&gt;./search.json&lt;/span&gt;
&lt;span class="go"&gt;./searchplugins&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;em&gt;search.json&lt;/em&gt; has some general info about the engines and seems to be
 pointing firefox to &lt;em&gt;searchplugins/&lt;/em&gt; for more details.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="go"&gt;(py)fakedrake@monolith ~/.mozilla/firefox/gsz5q06m.default $ ls searchplugins&lt;/span&gt;
&lt;span class="go"&gt;duckduckgo.xml  imdb.xml  spotify1.xml  youtube.xml&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Right what I was looking for. Let's take a look inside one of them&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;&amp;lt;SearchPlugin&lt;/span&gt; &lt;span class="na"&gt;xmlns=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;http://www.mozilla.org/2006/browser/search/&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;xmlns:os=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;http://a9.com/-/spec/opensearch/1.1/&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;os:ShortName&amp;gt;&lt;/span&gt;DuckDuckGo&lt;span class="nt"&gt;&amp;lt;/os:ShortName&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;os:Description&amp;gt;&lt;/span&gt;Search DuckDuckGo&lt;span class="nt"&gt;&amp;lt;/os:Description&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;os:InputEncoding&amp;gt;&lt;/span&gt;UTF-8&lt;span class="nt"&gt;&amp;lt;/os:InputEncoding&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;os:Image&lt;/span&gt; &lt;span class="na"&gt;width=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;16&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;height=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;16&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;data:image/x-icon;base64,AAABAAMAEBAAAA[...]&lt;span class="nt"&gt;&amp;lt;/os:Image&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;os:Url&lt;/span&gt; &lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;text/html&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;method=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;GET&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;template=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;https://duckduckgo.com/&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;os:Param&lt;/span&gt; &lt;span class="na"&gt;name=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;q&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;{searchTerms}&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/os:Url&amp;gt;&amp;lt;os:Url&lt;/span&gt; &lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;application/x-suggestions+json&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;method=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;GET&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;template=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;https://duckduckgo.com/ac/&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;os:Param&lt;/span&gt; &lt;span class="na"&gt;name=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;q&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;{searchTerms}&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class="nt"&gt;&amp;lt;os:Param&lt;/span&gt; &lt;span class="na"&gt;name=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;type&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;value=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;list&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/os:Url&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/SearchPlugin&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Awesome, now lets see what interfaces we can get to loading this
code. We will need access to the
&lt;a href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIBrowserSearchService"&gt;search service&lt;/a&gt;, so&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;bss&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;Cc&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;@mozilla.org/browser/search-service;1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;].&lt;/span&gt;&lt;span class="nx"&gt;getService&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;Ci&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;nsIBrowserSearchService&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now to me at least the documentation was not extremely obvious so I
had to check out the
&lt;a href="https://github.com/mozilla/gecko-dev/blob/master/toolkit/components/search/nsSearchService.js"&gt;implementation&lt;/a&gt;
which I encourage you to take a look at but it wont be really
necessary. After snooping around a bit I came up with.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nx"&gt;bss&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;addEngine&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;file:///home/fakedrake/Projects/Javascript/spotify.xml&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;Ci&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;nsISearchEngine&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;DATA_XML&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Where the contents of &lt;em&gt;spotify.xml&lt;/em&gt; are&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;&amp;lt;SearchPlugin&lt;/span&gt; &lt;span class="na"&gt;xmlns=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;http://www.mozilla.org/2006/browser/search/&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;xmlns:os=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;http://a9.com/-/spec/opensearch/1.1/&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;os:ShortName&amp;gt;&lt;/span&gt;Spotify&lt;span class="nt"&gt;&amp;lt;/os:ShortName&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;os:Description&amp;gt;&lt;/span&gt;Search Spotify&lt;span class="nt"&gt;&amp;lt;/os:Description&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;os:InputEncoding&amp;gt;&lt;/span&gt;UTF-8&lt;span class="nt"&gt;&amp;lt;/os:InputEncoding&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;os:Url&lt;/span&gt; &lt;span class="na"&gt;type=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;text/html&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;method=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;GET&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;template=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;https://play.spotify.com/search/{searchTerms}&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;/&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/SearchPlugin&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;And to my delight vimperator recognizes my custom spotify search engine!&lt;/p&gt;
&lt;p&gt;&lt;img alt="Spoify search engine" src="http://i.imgur.com/yukAwWr.png" /&gt;&lt;/p&gt;
&lt;p&gt;And not only that, but firefox was kind enough to add my xml to the
right place so it is permanent.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="go"&gt;(py)fakedrake@monolith ~/.mozilla/firefox/gsz5q06m.default/searchplugins $ ls&lt;/span&gt;
&lt;span class="go"&gt;duckduckgo.xml  imdb.xml  spotify.xml  youtube.xml&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now if you need more direct control over this. An equivalent to the
above would be:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nx"&gt;bss&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;addEngineWithDetails&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Spotify&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;spotify&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Search spotify&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;GET&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://play.spotify.com/search/{searchTerms}&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;em&gt;Note: this wont work if the aliases of the search engines conflict
 like they do here.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;This does exactly the same thing as having the data in an XML file and
loading it with &lt;code&gt;addEngine()&lt;/code&gt;. If you want to remove an engine you
can do it with:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nx"&gt;bss&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;removeEngine&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;bss&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getEngineByAlias&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;spotify&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;There's more you can do with the browser search service but I think I
would just be repeating the documentation from now on, I hope this is
a good example to get you started.&lt;/p&gt;</summary><category term="firefox"></category><category term="javascript"></category></entry><entry><title>Remote testing with git and ssh</title><link href="https://fakedrake.github.io/remote-testing-with-git-and-ssh.html" rel="alternate"></link><updated>2014-05-11T21:37:00+03:00</updated><author><name>Chris Perivolaropoulos</name></author><id>tag:fakedrake.github.io,2014-05-11:remote-testing-with-git-and-ssh.html</id><summary type="html">&lt;p&gt;Running tests is an important part of the development workflow. You
want to do it often and you want it to be quick. Yet at times tests
are not quick. Tests can be slow and they can be fat. This means that
you probably prefer to run them on a powerful server rather than your
slow, low on memory laptop that you like using by on the beach and
mostly away from power outlets. "You know what would be awesome?" I
thought to myself one day while sipping pina collada on the roof
garden of Think Silicon HQ, "if instead of running my tests locally
and wait for ages for them to finish, I could push my changes to a
remote server with git, run these tests with ssh and get the results
with just one command!". A friend pointed out that what I want is a
CI, and one might be able to make that work but what I actually want
is not scheduled testing. Rather I need the shortest, and least
painful for my laptop, path between a minor change on the codebase and
a usable format of the test results. Preferably in an emacs
&lt;a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Compilation-Mode.html"&gt;*compilation* buffer&lt;/a&gt;
(which is just output of the test command with the paths parsed as
hyperlinks).&lt;/p&gt;
&lt;p&gt;So I made a branch I call &lt;code&gt;bench&lt;/code&gt; because I was running some
benchamrks at the time, commited my failing code and pushed it to
github. Then I pulled the branch from our awesome server and ran the
tests. They finished in a fourth of time and my workstation was fully
functional during that time. "That was easy" I thought to myself. Then
I got the results parsed in emacs' compilation mode and tried to jump
to the first error. That failed. Miserably. The stack traces and
errors contained paths for the source files on the server.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Damn you brain" src="http://i.imgur.com/hTaOc3T.jpg" /&gt;&lt;/p&gt;
&lt;p&gt;One way to circumvent that would be to convert all paths to relative
but I would prefer absolute paths to work as well so I decided i would
pipe the output through sed and translate the paths to somthing
compilation-mode would be able to deal with. I came up with
&lt;em&gt;remote_test.sh&lt;/em&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="nv"&gt;REMOTE_ROOT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/path/to/remote-test&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;LOCAL_ROOT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/path/to/test&amp;quot;&lt;/span&gt;

&lt;span class="nv"&gt;REMOTE_SRV&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;localhost &lt;span class="c"&gt;# for testing&lt;/span&gt;
&lt;span class="nv"&gt;REMOTE_USER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;whoami&lt;span class="sb"&gt;`&lt;/span&gt;

&lt;span class="nv"&gt;SED_REMOTE_ROOT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$REMOTE_ROOT&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; sed &lt;span class="s1"&gt;&amp;#39;s/[\/&amp;amp;]/\\&amp;amp;/g&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;
&lt;span class="nv"&gt;SED_LOCAL_ROOT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$LOCAL_ROOT&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; sed &lt;span class="s1"&gt;&amp;#39;s/[\/&amp;amp;]/\\&amp;amp;/g&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;function&lt;/span&gt; local_paths &lt;span class="o"&gt;{&lt;/span&gt;
    sed &lt;span class="s2"&gt;&amp;quot;s/&lt;/span&gt;&lt;span class="nv"&gt;$SED_REMOTE_ROOT&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;$SED_LOCAL_ROOT&lt;/span&gt;&lt;span class="s2"&gt;/g&amp;quot;&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;function&lt;/span&gt; remote_paths &lt;span class="o"&gt;{&lt;/span&gt;
    sed &lt;span class="s2"&gt;&amp;quot;s/&lt;/span&gt;&lt;span class="nv"&gt;$SED_LOCAL_ROOT&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;$SED_REMOTE_ROOT&lt;/span&gt;&lt;span class="s2"&gt;/g&amp;quot;&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="nv"&gt;ARGS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$@&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;REMOTE_CMD&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$ARGS&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; remote_paths &lt;span class="k"&gt;)&lt;/span&gt;
&lt;span class="nv"&gt;REMOTE_PWD&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;pwd&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; remote_paths &lt;span class="k"&gt;)&lt;/span&gt;

&lt;span class="nb"&gt;echo &lt;/span&gt;Running: &lt;span class="nv"&gt;$REMOTE_CMD&lt;/span&gt;

ssh &lt;span class="nv"&gt;$REMOTE_USER&lt;/span&gt;@&lt;span class="nv"&gt;$REMOTE_SRV&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;cd &lt;/span&gt;&lt;span class="nv"&gt;$REMOTE_PWD&lt;/span&gt;&lt;span class="s2"&gt; &amp;amp;&amp;amp; &lt;/span&gt;&lt;span class="nv"&gt;$REMOTE_CMD&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&amp;amp;&lt;/span&gt; local_paths
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Notice the escaping of the paths so that characters in the paths dong
get confused for parts of the sed command. So let's test it.&lt;/p&gt;
&lt;p&gt;Run the tests again like this now:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;(workstation)$&lt;/span&gt; ./remote_test.sh &lt;span class="s1"&gt;&amp;#39;echo Path is: /path/to/test &amp;gt;&amp;amp;2&amp;#39;&lt;/span&gt;
&lt;span class="go"&gt;Running: echo Path is: /path/to/remote-test&lt;/span&gt;
&lt;span class="go"&gt;fakedrake@localhost&amp;#39;s password:&lt;/span&gt;
&lt;span class="go"&gt;Path is: /path/to/test&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Notice how the path on the command run by the remote server makes
sense to the server and the standard error when returned to us makes
sense to the local workstation. Thus if you, like me, have some
interesting way to generate paths in your test commands (ie some emacs
lisp to create run tests on a project local python virtual env) they
will be translated to paths that make sense on the server.&lt;/p&gt;
&lt;p&gt;That is cool but unless you use NFS (or afs or whatever network
filesystem) for home directories like we do in Think Silicon you also
need to let the server know what changes you made in the code. Git is
exactly what we need for that. My approach to solving this is to have
a temporary branch (ie &lt;code&gt;bench&lt;/code&gt;) that I will commit to whenever I want
to run a test. Then that branch will be pushed to the server and the
tests will run with the most recent code.&lt;/p&gt;
&lt;p&gt;It is, however, not very straightforward to just push changes to a
remote working tree. Pulling from the server is also not a good option
as I would hate to get into port forwarding on my local network if I
am working from home. So here is a hacky workaround for this. Make a
bare repository local to the server where I can push commits from
&lt;code&gt;bench&lt;/code&gt;. Once those are pushed, and before running the tests on
remote, the server will pull those changes, which should be pretty
fast since the repo is in the same filesystem. This has the added
benefit of not putting every little failing commit of &lt;code&gt;bench&lt;/code&gt; on
github (and having Travis check it for errors and who knows what
else).&lt;/p&gt;
&lt;p&gt;So to make a bare repository in &lt;em&gt;~/.testing&lt;/em&gt; on the server&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;(remote)$&lt;/span&gt; &lt;span class="nb"&gt;cd&lt;/span&gt; ~
&lt;span class="gp"&gt;(remote)$&lt;/span&gt; mkdir .testing
&lt;span class="gp"&gt;(remote)$&lt;/span&gt; &lt;span class="nb"&gt;cd&lt;/span&gt; .testing
&lt;span class="gp"&gt;(remote)$&lt;/span&gt; git clone --bare &amp;lt;some mirror of the project&amp;gt;
&lt;span class="gp"&gt;(remote)$&lt;/span&gt; &lt;span class="nb"&gt;cd&lt;/span&gt; /path/to/remote/project
&lt;span class="gp"&gt;(remote)$&lt;/span&gt; git remote add testing &lt;span class="nv"&gt;$HOME&lt;/span&gt;/.testing/project.git
&lt;span class="gp"&gt;(remote)$&lt;/span&gt; git checkout bench
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;On the local workstation add that as remote:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;(workstation)$&lt;/span&gt; &lt;span class="nb"&gt;cd&lt;/span&gt; /path/to/local/project
&lt;span class="gp"&gt;(workstation)$&lt;/span&gt; git remote add testing /home/remote-user/.testing/project.git
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Then have &lt;em&gt;test_remote.sh&lt;/em&gt; push there before doing anything else by
throwing in there something like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;BRANCH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;git branch &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;/\*/{print $2}&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;
&lt;span class="nv"&gt;GIT_REMOTE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&amp;lt;server&amp;gt;

&lt;span class="k"&gt;function&lt;/span&gt; git_draft_sync &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="nv"&gt;COMMIT_MSG&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;[&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;date +%s&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;] Draft commit&amp;quot;&lt;/span&gt;

    &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Will now commit a dumb commit to current branch.&amp;quot;&lt;/span&gt;

    &lt;span class="nb"&gt;echo &lt;/span&gt;Commiting: &lt;span class="nv"&gt;$COMMIT_MSG&lt;/span&gt;
    git commit -a -m &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$COMMIT_MSG&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;

    &lt;span class="nb"&gt;echo &lt;/span&gt;Pushing branch: &lt;span class="nv"&gt;$BRANCH&lt;/span&gt;
    git push &lt;span class="nv"&gt;$GIT_REMOTE&lt;/span&gt; &lt;span class="nv"&gt;$BRANCH&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;And have the server pill the updates on the branch before testing:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;REMOTE_CMD&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;(git pull testing &lt;/span&gt;&lt;span class="nv"&gt;$BRANCH&lt;/span&gt;&lt;span class="s2"&gt; &amp;amp;&amp;amp; &lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$ARGS&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; remote_paths&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;)&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;(and dont forget to run &lt;code&gt;git_draft_sync&lt;/code&gt; before ssh)&lt;/p&gt;
&lt;p&gt;And you are all set! My real world script for running python tests on
a remote server at CSAIL looks much like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="c"&gt;# Paths (don&amp;#39;t use / at the end)&lt;/span&gt;
&lt;span class="nv"&gt;REMOTE_ROOT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/path/to/remote/home/Projects&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;LOCAL_ROOT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/home/fakedrake/Projects/CSAIL/Python&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;REMOTE_SRV&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&amp;lt;remote-server&amp;gt;
&lt;span class="nv"&gt;REMOTE_USER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&amp;lt;username&amp;gt;


&lt;span class="nv"&gt;BRANCH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;git branch &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;/\*/{print $2}&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;
&lt;span class="nv"&gt;GIT_REMOTE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;local&lt;/span&gt;

&lt;span class="k"&gt;function&lt;/span&gt; git_draft_sync &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="nv"&gt;COMMIT_MSG&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;[&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;date +%s&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;] Draft commit&amp;quot;&lt;/span&gt;

    &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Will now commit a dumb commit to current branch.&amp;quot;&lt;/span&gt;

    &lt;span class="nb"&gt;echo &lt;/span&gt;Commiting: &lt;span class="nv"&gt;$COMMIT_MSG&lt;/span&gt;
    git commit -a -m &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$COMMIT_MSG&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;

    &lt;span class="nb"&gt;echo &lt;/span&gt;Pushing branch: &lt;span class="nv"&gt;$BRANCH&lt;/span&gt;
    git push &lt;span class="nv"&gt;$GIT_REMOTE&lt;/span&gt; &lt;span class="nv"&gt;$BRANCH&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="c"&gt;## -- No need to edit from here on --&lt;/span&gt;
&lt;span class="nv"&gt;SED_REMOTE_ROOT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$REMOTE_ROOT&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; sed &lt;span class="s1"&gt;&amp;#39;s/[\/&amp;amp;]/\\&amp;amp;/g&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;
&lt;span class="nv"&gt;SED_LOCAL_ROOT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$LOCAL_ROOT&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; sed &lt;span class="s1"&gt;&amp;#39;s/[\/&amp;amp;]/\\&amp;amp;/g&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;function&lt;/span&gt; local_paths &lt;span class="o"&gt;{&lt;/span&gt;
    sed &lt;span class="s2"&gt;&amp;quot;s/&lt;/span&gt;&lt;span class="nv"&gt;$SED_REMOTE_ROOT&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;$SED_LOCAL_ROOT&lt;/span&gt;&lt;span class="s2"&gt;/g&amp;quot;&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;function&lt;/span&gt; remote_paths &lt;span class="o"&gt;{&lt;/span&gt;
    sed &lt;span class="s2"&gt;&amp;quot;s/&lt;/span&gt;&lt;span class="nv"&gt;$SED_LOCAL_ROOT&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;$SED_REMOTE_ROOT&lt;/span&gt;&lt;span class="s2"&gt;/g&amp;quot;&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="nv"&gt;ARGS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$@&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;REMOTE_CMD&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;(git pull testing &lt;/span&gt;&lt;span class="nv"&gt;$BRANCH&lt;/span&gt;&lt;span class="s2"&gt; &amp;amp;&amp;amp; &lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$ARGS&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; remote_paths &lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;)&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;REMOTE_PWD&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;pwd&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; remote_paths &lt;span class="k"&gt;)&lt;/span&gt;

&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Running perliminaries:&amp;quot;&lt;/span&gt;

&lt;span class="nb"&gt;echo &lt;/span&gt;ARGS: &lt;span class="nv"&gt;$ARGS&lt;/span&gt;
&lt;span class="nb"&gt;echo &lt;/span&gt;Running: &lt;span class="nv"&gt;$REMOTE_CMD&lt;/span&gt;
&lt;span class="nb"&gt;echo &lt;/span&gt;Directory: &lt;span class="nv"&gt;$REMOTE_PWD&lt;/span&gt;
&lt;span class="nb"&gt;echo &lt;/span&gt;At: &lt;span class="nv"&gt;$REMOTE_USER&lt;/span&gt;@&lt;span class="nv"&gt;$REMOTE_SRV&lt;/span&gt;

git_draft_sync
ssh &lt;span class="nv"&gt;$REMOTE_USER&lt;/span&gt;@&lt;span class="nv"&gt;$REMOTE_SRV&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;cd &lt;/span&gt;&lt;span class="nv"&gt;$REMOTE_PWD&lt;/span&gt;&lt;span class="s2"&gt; &amp;amp;&amp;amp; &lt;/span&gt;&lt;span class="nv"&gt;$REMOTE_CMD&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&amp;amp;&lt;/span&gt; local_paths
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Put this in the root directory of your project and change the paths at
the top of the script to something that makes sense for you. Then tell
your editor to prepend &lt;code&gt;./remote_test.sh&lt;/code&gt; before the test
command. Thus my emacs setup for example would do:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nt"&gt;-&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="nt"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;mode&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nt"&gt;compilation&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="nt"&gt;default-directory&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;~/Projects/CSAIL/Python/WikipediaBase/&amp;quot;&lt;/span&gt; &lt;span class="nt"&gt;-&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="nt"&gt;-&lt;/span&gt;
&lt;span class="nt"&gt;Comint&lt;/span&gt; &lt;span class="nt"&gt;started&lt;/span&gt; &lt;span class="nt"&gt;at&lt;/span&gt; &lt;span class="nt"&gt;Sun&lt;/span&gt; &lt;span class="nt"&gt;May&lt;/span&gt; &lt;span class="nt"&gt;11&lt;/span&gt; &lt;span class="nt"&gt;23&lt;/span&gt;&lt;span class="nd"&gt;:17:22&lt;/span&gt;

&lt;span class="o"&gt;./&lt;/span&gt;&lt;span class="nt"&gt;remote_test&lt;/span&gt;&lt;span class="nc"&gt;.sh&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;fakedrake&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;Projects&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;CSAIL&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;Python&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;py&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="nt"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;python&lt;/span&gt;  &lt;span class="nt"&gt;setup&lt;/span&gt;&lt;span class="nc"&gt;.py&lt;/span&gt; &lt;span class="nt"&gt;test&lt;/span&gt;
&lt;span class="nt"&gt;Running&lt;/span&gt; &lt;span class="nt"&gt;perliminaries&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
&lt;span class="nt"&gt;ARGS&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;fakedrake&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;Projects&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;CSAIL&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;Python&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;py&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="nt"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;python&lt;/span&gt; &lt;span class="nt"&gt;setup&lt;/span&gt;&lt;span class="nc"&gt;.py&lt;/span&gt; &lt;span class="nt"&gt;test&lt;/span&gt;
&lt;span class="nt"&gt;Running&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nt"&gt;git&lt;/span&gt; &lt;span class="nt"&gt;pull&lt;/span&gt; &lt;span class="nt"&gt;testing&lt;/span&gt; &lt;span class="nt"&gt;bench&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;path&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;to&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;remote&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;Projects&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;py&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="nt"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;python&lt;/span&gt; &lt;span class="nt"&gt;setup&lt;/span&gt;&lt;span class="nc"&gt;.py&lt;/span&gt; &lt;span class="nt"&gt;test&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="nt"&gt;Directory&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;path&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;to&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;remote&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;Projects&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;WikipediaBase&lt;/span&gt;
&lt;span class="nt"&gt;At&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;user&lt;/span&gt; &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;@&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;remote-server&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;Will&lt;/span&gt; &lt;span class="nt"&gt;now&lt;/span&gt; &lt;span class="nt"&gt;commit&lt;/span&gt; &lt;span class="nt"&gt;a&lt;/span&gt; &lt;span class="nt"&gt;dumb&lt;/span&gt; &lt;span class="nt"&gt;commit&lt;/span&gt; &lt;span class="nt"&gt;to&lt;/span&gt; &lt;span class="nt"&gt;current&lt;/span&gt; &lt;span class="nt"&gt;branch&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
&lt;span class="nt"&gt;Commiting&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1399839442&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt; &lt;span class="nt"&gt;Draft&lt;/span&gt; &lt;span class="nt"&gt;commit&lt;/span&gt;
&lt;span class="nt"&gt;On&lt;/span&gt; &lt;span class="nt"&gt;branch&lt;/span&gt; &lt;span class="nt"&gt;bench&lt;/span&gt;
&lt;span class="nt"&gt;Untracked&lt;/span&gt; &lt;span class="nt"&gt;files&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
    &lt;span class="nt"&gt;TAGS&lt;/span&gt;
    &lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;...&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;

&lt;span class="nt"&gt;nothing&lt;/span&gt; &lt;span class="nt"&gt;added&lt;/span&gt; &lt;span class="nt"&gt;to&lt;/span&gt; &lt;span class="nt"&gt;commit&lt;/span&gt; &lt;span class="nt"&gt;but&lt;/span&gt; &lt;span class="nt"&gt;untracked&lt;/span&gt; &lt;span class="nt"&gt;files&lt;/span&gt; &lt;span class="nt"&gt;present&lt;/span&gt;
&lt;span class="nt"&gt;Pushing&lt;/span&gt; &lt;span class="nt"&gt;branch&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nt"&gt;bench&lt;/span&gt;
&lt;span class="nt"&gt;Password&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
&lt;span class="nt"&gt;Everything&lt;/span&gt; &lt;span class="nt"&gt;up-to-date&lt;/span&gt;
&lt;span class="nt"&gt;Password&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
&lt;span class="nt"&gt;From&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;path&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;to&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;remote&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;home&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nc"&gt;.testing&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;WikipediaBase&lt;/span&gt;
 &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="nt"&gt;branch&lt;/span&gt;            &lt;span class="nt"&gt;bench&lt;/span&gt;      &lt;span class="nt"&gt;-&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;FETCH_HEAD&lt;/span&gt;
&lt;span class="nt"&gt;Already&lt;/span&gt; &lt;span class="nt"&gt;up-to-date&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
&lt;span class="nt"&gt;running&lt;/span&gt; &lt;span class="nt"&gt;test&lt;/span&gt;
&lt;span class="nt"&gt;running&lt;/span&gt; &lt;span class="nt"&gt;egg_info&lt;/span&gt;

&lt;span class="cp"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;...&lt;/span&gt;&lt;span class="cp"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;And compilation-mode sees the paths that it expects so I can jump
around the source based on the errors. If you haven't done already you
may also want to setup password-less login to your server. Not only is
it easier but it is much safer.&lt;/p&gt;</summary><category term="testin"></category><category term="git"></category><category term="ssh"></category><category term="remote"></category></entry><entry><title>Moving git branches across repositories</title><link href="https://fakedrake.github.io/moving-git-branches-across-repositories.html" rel="alternate"></link><updated>2014-05-07T15:49:00+03:00</updated><author><name>Chris Perivolaropoulos</name></author><id>tag:fakedrake.github.io,2014-05-07:moving-git-branches-across-repositories.html</id><summary type="html">&lt;p&gt;In a perfect world there is a one-to-one relationship between projects
and git trees. As you are happily working on your local repo, and
decide you want to get some commits from a different source you just
&lt;code&gt;git remote add&lt;/code&gt; that source and you have full access to it's
commits. Well sometimes things do not go as smoothly and you may find
yourself wanting to move your branch to a remote repo that may have a
largely common codebase but few to no common commits. Well turns out
git can handle that pretty easily. Here is how in one line:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="go"&gt;git log --reverse --cherry master...&amp;lt;your-branch&amp;gt; --pretty=email --patch-with-stat | (cd /path/to/new/repo &amp;amp;&amp;amp; git checkout -b &amp;lt;your-branch&amp;gt; &amp;amp;&amp;amp; git am)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;It is quite simple really: we use &lt;code&gt;git log&lt;/code&gt; to get a comprehensive
description of each commit in &lt;code&gt;&amp;lt;your-branch&amp;gt;&lt;/code&gt;. Then create a new
branch at the new repo with the same name and pipe the descriptions of
the commits to &lt;code&gt;git am&lt;/code&gt; to create them in the new place.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Note:&lt;/em&gt; the commits in the new repo will not have the same SHA as in
 the old one so we are not really &lt;em&gt;moving&lt;/em&gt; the commits from one repo
 to another as much as &lt;em&gt;recreating&lt;/em&gt; them.&lt;/p&gt;</summary><category term="git"></category><category term="branch"></category><category term="shell"></category></entry><entry><title>Gdb signals</title><link href="https://fakedrake.github.io/gdb-signals.html" rel="alternate"></link><updated>2014-05-06T16:36:00+03:00</updated><author><name>Chris Perivolaropoulos</name></author><id>tag:fakedrake.github.io,2014-05-06:gdb-signals.html</id><summary type="html">&lt;p&gt;So unless you are debugging your own program and you know what you are
doing this is probably not what you expect to happen while a program
runs under GDB.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;Program received signal SIGUSR1, User defined signal 1.
[Switching to Thread 0x7fffcff2c700 (LWP 3296)]
...
(gdb)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;You may hit &lt;code&gt;c&lt;/code&gt; to continue but this will come up again sooner or
later and I like my breakpoints to be tidy.&lt;/p&gt;
&lt;p&gt;First take a look at how gdb handles each signal.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;
(gdb) info signals
Signal        Stop  Print   Pass to program Description

SIGHUP        Yes   Yes     Yes     Hangup
SIGINT        Yes   Yes     No      Interrupt
SIGQUIT       Yes   Yes     Yes     Quit
SIGILL        Yes   Yes     Yes     Illegal instruction
SIGTRAP       Yes   Yes     No      Trace/breakpoint trap
SIGABRT       Yes   Yes     Yes     Aborted
SIGEMT        Yes   Yes     Yes     Emulation trap

[...]

SIGWINCH      No    No      Yes     Window size changed
SIGLOST       Yes   Yes     Yes     Resource lost
&lt;b&gt;SIGUSR1      Yes Yes     Yes     User defined signal 1&lt;/b&gt;
SIGUSR2       Yes   Yes     Yes     User defined signal 2
SIGPWR        Yes   Yes     Yes     Power fail/restart

[...]

EXC_EMULATION Yes   Yes     Yes     Emulation instruction
EXC_SOFTWARE  Yes   Yes     Yes     Software generated exception
EXC_BREAKPOINT Yes  Yes     Yes     Breakpoint

Use the "handle" command to change these tables.
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;As the command says you want &lt;code&gt;SIGUSR1&lt;/code&gt; to not stop and also for it to
be passed to the program. The other thing we notice here is that
&lt;code&gt;SIGTRAP&lt;/code&gt; is not passed to the program.&lt;/p&gt;
&lt;p&gt;To have &lt;code&gt;SIGUSR1&lt;/code&gt; be ignored by GDB&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;(gdb) handle SIGUSR1 nostop noprint
Signal        Stop  Print   Pass to program Description
SIGUSR1       No    No  Yes     User defined signal 1
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now here is another recurring interrupt related issue: Sometimes you
need to to pass control to gdb while the program is running. The
default way would be to hit &lt;code&gt;C-c&lt;/code&gt;. In a very rare occasion (ie. qemu)
the process will catch the key and will not stop. Instead of
despairing you can try sending it a &lt;code&gt;SIGTRAP&lt;/code&gt;. That will stop the
program as if gdb had encountered a breakpoint. From another terminal
run.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;$&lt;/span&gt; pkill -TRAP &amp;lt;process-name&amp;gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;If you are using &lt;em&gt;emacs&lt;/em&gt; and &lt;em&gt;gud&lt;/em&gt; like me you can automate this with:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defun&lt;/span&gt; &lt;span class="nv"&gt;my:gud-trap-process&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;&amp;amp;optional&lt;/span&gt; &lt;span class="nv"&gt;wrapping-script&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;interactive&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;*P&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;let&lt;/span&gt; &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="nv"&gt;child-pid&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;xargs pgrep -P | head -1 |&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;async-shell-command&lt;/span&gt;
     &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;format&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;echo %d | %s %s xargs echo kill -TRAP&amp;quot;&lt;/span&gt;
         &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;process-id&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;get-buffer-process&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;*gud*&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
         &lt;span class="nv"&gt;child-pid&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nv"&gt;wrapping-script&lt;/span&gt; &lt;span class="nv"&gt;child-pid&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)))))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Putting this in your &lt;em&gt;.emacs&lt;/em&gt; will let you do &lt;code&gt;M-x
my:gud-trap-process&lt;/code&gt; to give control to gdb. If you are running gdb
from within a shell script like I usually do provide a prefix
argument, ie. &lt;code&gt;C-u M-x my:gud-trap-process&lt;/code&gt; to handle child processes
correctly. I also have it bound to &lt;code&gt;C-x C-a t&lt;/code&gt; for brevity:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;(global-set-key (kbd &amp;quot;C-x C-a t&amp;quot;) `my:gud-trap-process)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;This process will not run exactly the shell command I mentioned
earlier but rather it will find the pid of gdb and send &lt;code&gt;SIGTRAP&lt;/code&gt; to it's
first child process. So if you want to automate the process in another
way here is the main idea:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;pgrep -P &amp;lt;gdb pid&amp;gt; &lt;span class="p"&gt;|&lt;/span&gt; head -1 &lt;span class="p"&gt;|&lt;/span&gt; xargs &lt;span class="nb"&gt;kill&lt;/span&gt; -TRAP
&lt;/pre&gt;&lt;/div&gt;</summary><category term="GDB"></category><category term="C/C++"></category><category term="signals"></category></entry><entry><title>Dumping tab information with vimperator</title><link href="https://fakedrake.github.io/dumping-tab-information-with-vimperator.html" rel="alternate"></link><updated>2014-04-20T20:18:00+03:00</updated><author><name>Chris Perivolaropoulos</name></author><id>tag:fakedrake.github.io,2014-04-20:dumping-tab-information-with-vimperator.html</id><summary type="html">&lt;p&gt;To me it is quite usual that I am looking at a list of links to things
(songs, articls, books etc.) and I want to first select the ones I am
interested in and then look into them one by one. Most of the time
this does not go as smoothly as I would want it to. I wildly
underestimate the length of the list and not only do I get many many
more interesting results than I expected, but I also spend so much
time going through the entire list that I need to check them later. I
could bookmark everything and look at it later but the perfect
solution would be to dump everything in a text file and
&lt;a href="http://gist.github.com"&gt;gist&lt;/a&gt; it or then categorize it according to
artist with Python or something else equally and needlessly nerdy.&lt;/p&gt;
&lt;p&gt;So anyway, turns out firefox welcomes this kind of thing if you are a
core developer and have deep knowledge of it's inter-workings or if
you have vimperator to abstract the interface/service
inconvenience. And the matter is actually very simple.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nx"&gt;tabdump&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="nx"&gt;tabs&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;get&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;forEach&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nx"&gt;tabdump&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot; ~~~ &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;\n&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="nx"&gt;io&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;File&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;~/Documents/tabs&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;tabdump&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;If you haven't got any better way of running more than one line of
code on firefox you can use vimperator's &lt;code&gt;:js&lt;/code&gt; which should go like&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="nx"&gt;js&lt;/span&gt; &lt;span class="nx"&gt;tabdump&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;tabs&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;get&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;forEach&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nx"&gt;tabdump&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot; ~~~ &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;\n&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="p"&gt;});&lt;/span&gt; &lt;span class="nx"&gt;io&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;File&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;~/Documents/tabs&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;tabdump&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;So in brief what does this code do, it uses vimperator's interface to
tabs to get a list of all tabs (basically tuples) and then you
concatenate those tuples together and dump them into a string (line
2). Then vimperator provides a simple way of file io with &lt;code&gt;io.File&lt;/code&gt; to
throw everything into a file. And there you have it&lt;/p&gt;
&lt;p&gt;If for example I were looking up bands going through a list and run
the above I would come up with something like&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;[...]&lt;/span&gt;

&lt;span class="na"&gt;23 ~~~ kyuss at DuckDuckGo ~~~ https://duckduckgo.com/?q&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;kyuss&lt;/span&gt;
&lt;span class="na"&gt;24 ~~~ 311 at DuckDuckGo ~~~ https://duckduckgo.com/?q&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;311&lt;/span&gt;
&lt;span class="na"&gt;25 ~~~ high on fire at DuckDuckGo ~~~ https://duckduckgo.com/?q&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;high+on+fire&lt;/span&gt;
&lt;span class="na"&gt;26 ~~~ sleep at DuckDuckGo ~~~ https://duckduckgo.com/?q&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;sleep&lt;/span&gt;
&lt;span class="na"&gt;27 ~~~ cottonmouth kings at DuckDuckGo ~~~ https://duckduckgo.com/?q&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;cottonmouth+kings&lt;/span&gt;

&lt;span class="k"&gt;[...]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;em&gt;EDIT&lt;/em&gt;: If you want to reopen some of those you can easily do it with&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="nx"&gt;js&lt;/span&gt; &lt;span class="nx"&gt;lines&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;io&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;File&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;~/Documents/tabs&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;read&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;\n&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="nx"&gt;js&lt;/span&gt; &lt;span class="nx"&gt;lines&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;l&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;l&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot; ~~~ &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]}).&lt;/span&gt;&lt;span class="nx"&gt;slice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;23&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;forEach&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;url&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nx"&gt;liberator&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;url&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nx"&gt;where&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;liberator&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;NEW_TAB&lt;/span&gt;&lt;span class="p"&gt;})})&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Which should open again tabs 7 to 22.&lt;/p&gt;</summary><category term="firefox"></category><category term="vimperator"></category><category term="javascript"></category><category term="tabs"></category></entry><entry><title>Dealing with enormous ramdisks and Qemu</title><link href="https://fakedrake.github.io/dealing-with-enormous-ramdisks-and-qemu.html" rel="alternate"></link><updated>2014-03-31T22:30:00+03:00</updated><author><name>Chris Perivolaropoulos</name></author><id>tag:fakedrake.github.io,2014-03-31:dealing-with-enormous-ramdisks-and-qemu.html</id><summary type="html">&lt;p&gt;&lt;strong&gt;WARNING:&lt;/strong&gt; This is hacky and BAD. Do not use 500M ramdisks for
anything crucial. Make them small and mount the rest of the filesystem
using the rootfs related boot commands and the &lt;code&gt;-hda&lt;/code&gt; option on qemu
or use nfs or whatever.&lt;/p&gt;
&lt;p&gt;So there are times in Think-Silicon land when permanent storage
devices may not always be there for you. May that be because your
ethernet device screws up and you are relying on NFS for rootfs, or
may it be because I just want the kernel to do my bidding and load a
ramdisk that is as big as half a Gigabyte. The point is, shoving such
a big ramdisk down the kernel's throat will result in it choking into
something like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;...

RAMDISK: ext2 filesystem found at block 0
RAMDISK: image too big! (500496KiB/16384KiB)
xemacps e000b000.eth: Set clk to 124999998 Hz
xemacps e000b000.eth: link up (1000/FULL)
List of all partitions:
1f00            1024 mtdblock0  (driver?)
1f01            5120 mtdblock1  (driver?)
1f02             128 mtdblock2  (driver?)
1f03            6016 mtdblock3  (driver?)
1f04            4096 mtdblock4  (driver?)
No filesystem could mount root, tried:  ext3 ext2 ext4 vfat msdos
Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(1,0)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Turns out you can do something about it, may it be hacky and
horrible. This is the tale of a glorious journey through the mysts of
the linux kernel to a busybox prompt inside of Qemu.&lt;/p&gt;
&lt;p&gt;Let's start at the beginning. When the kernel registers a block device
it then registers a number of disks, with the same major number as the
block device, that take upon them the actual work of the driver. This
paradigm is implemented in &lt;em&gt;block/genhd.c&lt;/em&gt;. This description is also
neither complete nor 100% accurate but it is good enough for now.&lt;/p&gt;
&lt;p&gt;When the kernel boots up, one of the first drivers it loads is one
called &lt;em&gt;brd&lt;/em&gt; as in &lt;em&gt;block ramdisk device&lt;/em&gt;. That driver creates a block
device interface to the main memory and lives in
&lt;em&gt;drivers/block/brd.c&lt;/em&gt;. The block device is created under the name
&lt;em&gt;ramdisk&lt;/em&gt; and major number 1 and gets disks called &lt;em&gt;ram#&lt;/em&gt; as in
&lt;em&gt;ram0&lt;/em&gt;, &lt;em&gt;ram1&lt;/em&gt;, ..., (16 by default). Those disks each represent a
space in virtual memory and have the same size, which by default is
16M. The original problem we faced above is basically the kernel
trying to fit a 500M initrd in one of those 16M disks. What we need to
do basically is resize them so that the ramdisk fits nicely.&lt;/p&gt;
&lt;p&gt;As either google or the code in &lt;em&gt;brd.c&lt;/em&gt; will kindly tell you you can
always tell the kernel in the boot commands &lt;em&gt;ramdisk_size=500000&lt;/em&gt;,
which will supposedly set things up so that we can just tell qemu
&lt;code&gt;-initrd &amp;lt;fucking-huge-ramdisk.img&amp;gt;&lt;/code&gt; and the next thing we know we are
happily writing commands on busybox. Right?&lt;/p&gt;
&lt;p&gt;&lt;img alt="WRONG" src="http://www.themistermen.co.uk/images/MrWrong.jpg" /&gt;&lt;/p&gt;
&lt;p&gt;The kernel tries to create 16 such 500M disks. Which sucks. They are
virtual memory so it will actually boot but it is not something you
want on your virtual machine. We need to change the number of disks
the driver creates. You can do that via the &lt;code&gt;CONFIG_BLK_DEV_RAM_COUNT&lt;/code&gt;
option but I hate having to compile the entire kernel to change
something that can to some extent be changed from user space. Did I
mention you can create more such disks with &lt;code&gt;rdev -r&lt;/code&gt; from the shell?
That is because I have no idea if it is
true. &lt;em&gt;Documentation/blockdev/ramdisk.txt&lt;/em&gt; told me and it betrayed me
once by mentioning that I can &lt;code&gt;ramdisk_blocksize=N&lt;/code&gt; which if you grep
the source is hard to believe, and trust is lost easier than earned.&lt;/p&gt;
&lt;p&gt;Anyway what I ended up doing is editing &lt;code&gt;ramdisk_size()&lt;/code&gt; from this&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="cm"&gt;/* Legacy boot options - nonmodular */&lt;/span&gt;
&lt;span class="k"&gt;static&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;__init&lt;/span&gt; &lt;span class="nf"&gt;ramdisk_size&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;str&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;rd_size&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;simple_strtol&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;to look more like this&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="cm"&gt;/* Legacy boot options - nonmodular */&lt;/span&gt;
&lt;span class="k"&gt;static&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;__init&lt;/span&gt; &lt;span class="nf"&gt;ramdisk_size&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;str&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;index&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;get_option&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;switch&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;rd_size&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="k"&gt;break&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;rd_nr&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="k"&gt;break&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now you can pass &lt;em&gt;ramdisk_size=500000,1&lt;/em&gt; to tell the driver to make
just one 500M disk, while having &lt;em&gt;ramdisk_size=500000&lt;/em&gt; behave as
before. Noice!&lt;/p&gt;
&lt;p&gt;So now we simply run qemu&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;qemu-system-arm -M xilinx-zynq-a9 -m 1024 -serial null -serial
    mon:stdio -dtb ./devtree.dtb -kernel path/to/zImage
    -initrd path/to/enormous-ramdisk.img -nographic
    -append &amp;quot;console=ttyPS0,115200 root=/dev/ram rw ip=:::::eth0:dhcp \
        loglevel=7 ramdisk_size=500496,1p&amp;quot;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;And everything boots correctly!!&lt;/p&gt;
&lt;p&gt;I always run qemu from within a script so for completeness here is the
relevan excerpt&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;...

&lt;span class="nv"&gt;BOOTCMD&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;console=ttyPS0,115200 root=/dev/ram rw ip=:::::eth0:dhcp loglevel=7 ramdisk_size=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;du --apparent-size &lt;span class="nv"&gt;$RAMDISK&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{print $1}&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;,1&amp;#39;&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;CMD&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$QEMU&lt;/span&gt;&lt;span class="s2"&gt; -M xilinx-zynq-a9  -m 1024  -serial null -serial mon:stdio -dtb &lt;/span&gt;&lt;span class="nv"&gt;$DTB&lt;/span&gt;&lt;span class="s2"&gt; -kernel &lt;/span&gt;&lt;span class="nv"&gt;$KERNEL&lt;/span&gt;&lt;span class="s2"&gt; -initrd &lt;/span&gt;&lt;span class="nv"&gt;$RAMDISK&lt;/span&gt;&lt;span class="s2"&gt; -nographic&amp;quot;&lt;/span&gt;

&lt;span class="nb"&gt;echo&lt;/span&gt; -e &lt;span class="s2"&gt;&amp;quot;Running: &lt;/span&gt;&lt;span class="nv"&gt;$CMD&lt;/span&gt;&lt;span class="s2"&gt; -append &lt;/span&gt;&lt;span class="nv"&gt;$BOOTCMD&lt;/span&gt;&lt;span class="s2"&gt;\nC-a x to kill...&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;$CMD&lt;/span&gt; -append &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$BOOTCMD&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;As an extra benefit this will actually measure the ramdisk and make
the disk size only as big as it needs to be.&lt;/p&gt;</summary><category term="kernel"></category><category term="qemu"></category></entry><entry><title>When printks are too many</title><link href="https://fakedrake.github.io/when-printks-are-too-many.html" rel="alternate"></link><updated>2014-03-28T20:45:00+02:00</updated><author><name>Chris Perivolaropoulos</name></author><id>tag:fakedrake.github.io,2014-03-28:when-printks-are-too-many.html</id><summary type="html">&lt;p&gt;Being too lazy to use proper debugging methods as I am (although what
proper debugging methods are is sometimes
&lt;a href="http://www.linuxtoday.com/infrastructure/2000090700221OSCYKN"&gt;debateable&lt;/a&gt;),
I always (over)use printks to debug the kernel. Now the problem with
printks is that when you find your bug they are all over the kernel
code and it can be a real pain to remove them one by one.&lt;/p&gt;
&lt;p&gt;This is not a trivial problem when you spend more than a couple of
hours on a particular problem. The good news is that due to the nature
of printk-debugging you usually know which one of your nasty hacks
fixed the problem you were looking for. Thus you can &lt;code&gt;git diff&lt;/code&gt; those
to just keep the useful changes (I use emacs' ediff, meld or anything
interactive should be good enough), then you commit just those.&lt;/p&gt;
&lt;p&gt;You should learn from my mistakes and not blindly &lt;code&gt;git checkout&lt;/code&gt; at
the project root. For me there are usually some nasty device tree
changes that I make to fit Qemu and also my .config is setup for
debugging. I definitely dont want reverting any of that. Actually all
I want to revert is the .c files I threw printks in.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;git status | sed -n &amp;#39;s/.*modified: *\(.*\.c\)/\1/p&amp;#39; | xargs git checkout
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Works 99% of the time. To avoid the tragedy of the other 1% make sure
you take a look at &lt;code&gt;git status&lt;/code&gt; &lt;em&gt;beforehand&lt;/em&gt;.&lt;/p&gt;</summary><category term="git"></category><category term="kernel"></category><category term="debugging"></category></entry></feed>